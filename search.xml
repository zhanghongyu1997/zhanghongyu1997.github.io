<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/11/17/hello-world/"/>
      <url>/2019/11/17/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>shiro学习笔记</title>
      <link href="/2019/09/18/shiro%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2019/09/18/shiro%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="shiro架构"><a href="#shiro架构" class="headerlink" title="shiro架构"></a>shiro架构</h2><p><img src="img/23.png" alt=""></p><ol><li><strong>subject：</strong>主体，可以是用户也可以是程序，主体要访问系统，系统需要对主体进行认证、授权。</li><li><strong>securityManager：</strong>安全管理器，主体进行认证和授权都 是通过securityManager进行。</li><li><strong>authenticator：</strong>认证器，主体进行认证最终通过authenticator进行的。</li><li><strong>authorizer：</strong>授权器，主体进行授权最终通过authorizer进行的。</li><li><strong>sessionManager：</strong>web应用中一般是用web容器对session进行管理，shiro也提供一套session管理的方式。</li><li><strong>SessionDao：</strong>  通过SessionDao管理session数据，针对个性化的session数据存储需要使用sessionDao。</li><li><strong>cache Manager：</strong>缓存管理器，主要对session和授权数据进行缓存，比如将授权数据通过cacheManager进行缓存管理，和ehcache整合对缓存数据进行管理。</li><li><strong>realm：</strong>域，领域，相当于数据源，通过realm存取认证、授权相关数据。</li></ol><p><strong>注意：在realm中存储授权和认证的逻辑。</strong></p><ol start="9"><li><strong>cryptography：</strong>密码管理，提供了一套加密/解密的组件，方便开发。比如提供常用的散列、加/解密等功能。比如 md5散列算法。</li></ol><h2 id="shiro认证流程"><a href="#shiro认证流程" class="headerlink" title="shiro认证流程"></a>shiro认证流程</h2><p><img src="img/shiro%E6%B5%81%E7%A8%8B.png" alt="shiro流程"></p><p><strong>shiro授权流程</strong></p><ol><li><p>对subject进行授权，调用方法IsPermitted(“permission串”)</p></li><li><p>SecurityManager执行授权，通过ModularRealmAuthorizer执行授权</p></li><li><p>ModularRealmAuthorizer执行realm(自定义)从数据库查询权限数据 调用realm的授权方法:doGetAuthorizationInfo</p></li><li><p>Realm从数据库查询权限数据，返回ModularRealmAuthorizer</p></li><li><p>ModularRealmAuthorizer调用PermissionResolver进行权限串比对</p></li><li><p>如果比对后，isPermitted中“permission串”在realm查询到权限数据中，说明用户访问permission串有权限，否则没有权限，抛出异常。</p><h2 id="shiro与项目整合"><a href="#shiro与项目整合" class="headerlink" title="shiro与项目整合"></a>shiro与项目整合</h2><h3 id="在web-xml中配置shiro的filter"><a href="#在web-xml中配置shiro的filter" class="headerlink" title="在web.xml中配置shiro的filter"></a>在web.xml中配置shiro的filter</h3><p>在web系统中，shiro也通过filter进行拦截，filter拦截成功后将操作权交给spring中配置的filterChain（过滤链）</p><p><img src="img/webxml.png" alt="web.xml"></p><h3 id="在spring中配置filter"><a href="#在spring中配置filter" class="headerlink" title="在spring中配置filter"></a>在spring中配置filter</h3><p>在applicationContext-shiro.xml 中配置web.xml中filter对应spring容器中的bean</p></li></ol><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>shiroFilter<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.spring.web.ShiroFilterFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!-- loginUrl认证提交地址，如果没有认证将会请求此地址进行认证，请求此地址将由formAuthenticationFilter进行表单认证 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loginUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/login.do<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 认证成功后统一跳转到first.action,建议不配置,因shiro认证成功后会自动跳转到上一个请求路径--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>successUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/index.do<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 指定无权限的访问页面 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>unauthorizedUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/refuse.jsp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 过虑器链定义，从上向下顺序执行，一般将/**放在最下边 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>filterChainDefinitions<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 过滤器从上向下顺序执行 --></span>            <span class="token comment" spellcheck="true">&lt;!-- 对静态资源设置匿名访问 --></span>            /images/** = anon            /js/** = anon            /css/** = anon            /favicon.ico = anon            <span class="token comment" spellcheck="true">&lt;!--请求login.action地址,shiro清除session--></span>            /logout.do = logout            <span class="token comment" spellcheck="true">&lt;!--商品查询权限--></span>            <span class="token comment" spellcheck="true">&lt;!--/item/editItem.action = perms[item:update]--></span>            <span class="token comment" spellcheck="true">&lt;!--/item/edit.action = perms[item:add]--></span>            <span class="token comment" spellcheck="true">&lt;!-- 所用的url必须都认证通过后才可访问 --></span>            /** = authc        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 7.2:安全管理器 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.web.mgt.DefaultWebSecurityManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>realm<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userRealm<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!--缓存器--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cacheManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cacheManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 注入session管理器 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 7.3:自定义 realm --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userRealm<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.chxf.user.realm.MyRealm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 将凭证匹配器设置到realm中 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>credentialsMatcher<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>credentialsMatcher<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p><strong>1. 原理</strong></p><p>使用FormAuthenticationFilter过滤器实现，原理如下：</p><p>将用户没有认证时，请求loginURL进行认证，用户身份和用户密码提交数据到loginURL</p><p>FormAuthenticationFilter拦截住取出request中的username和password（两个参数名称是可以配置的）</p><p>FormAuthenticationFilter调用realm传入一个token（username和password）</p><p>Shiro中过滤器</p><p>Realm认证时根据username查询用户信息（在Activeuser中存储，包括userid，usercode，username，menus）</p><p>如果查询不到，realm返回null，FormAuthenticationFilter向request域中填充一个参数（记录了异常信息）</p><p>*<em>2. 实现 *</em></p><p>(登录提交地址，和applicationContext**-shiro.xml中配置的loginURL一致）</p><p><img src="img/controller-login.png" alt=""></p><p><strong>3. 认证拦截过滤器</strong></p><p>在applicationContext-shiro.xml中配置</p><p><img src="img/shiroxml.png" alt=""></p><h3 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h3><p><strong>使用logoutFilter</strong></p><p>不用我们去实现退出，只要去访问一个退出的URL（该URL是可以不存在），有logoutFilter拦截住，清除session 在applicationContext-shiro.xml中配置</p><p><strong>logout.action = logout</strong></p><h3 id="认证信息在页面显示"><a href="#认证信息在页面显示" class="headerlink" title="认证信息在页面显示"></a>认证信息在页面显示</h3><ol><li>认证后用户菜单在首页显示</li><li>认证后用户信息在页头显示</li></ol><h3 id="修改realm设置完整认证信息"><a href="#修改realm设置完整认证信息" class="headerlink" title="修改realm设置完整认证信息"></a>修改realm设置完整认证信息</h3><p>​    Realm从数据库查询用户信息，将用户菜单，usercode，username等 设置在SimpleAuthenticationInfo中 此处使用静态数据模拟实现</p><p><img src="img/realm.png" alt=""></p><p>//从shiro的session中取出activeUser</p><p>Subject subject = SecurityUtils.getSubject();</p><p>//取出身份信息</p><p>ActiveUser activeUser = (ActiveUser) subject.getPrincipal();</p><p>//通过model传到页面</p><p>Model.addAtribute(“activeUser”,activeUser);</p><h3 id="授权过滤器测试"><a href="#授权过滤器测试" class="headerlink" title="授权过滤器测试"></a>授权过滤器测试</h3><p><strong>使用permissionsAuthorizationFilter</strong></p><p>在applicationContext-shiro.xml中配置</p><p><img src="img/permision.png" alt=""></p><p><strong>测试流程:</strong></p><ol><li>在applicationContext-shiro.xml中配置filter规则</li></ol><p><img src="img/1.png" alt=""></p><ol start="2"><li>用户在认证通过后，请求/item/editItem.action</li><li>被permissionsAuthorizationFilter拦截，发现需要“item:edit”权限</li><li>permissionsAuthorizationFilter调用realm中的doGetAuthorizationInfo获取数据库中正确的权限</li><li>permissionsAuthorizationFilter对item:edit和从realm中获取权限进行对比，如果“item：edit”在realm返回的权限列表中，授权通过</li></ol><h3 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h3><ol><li><p><strong>在applicationContext-shiro.xml中配置过滤器连接，需要将全部的url和权限对应起来进行配置，比较麻烦不方便使用</strong></p><p>（1）可通过注解方式授权</p></li></ol><p><img src="img/2.png" alt=""></p><p>​        （2）在springmvc.xml中配置shiro注解支持，可在controller层中使用shiro注解配置权限</p><p><img src="img/3.png" alt=""></p><p>​        （3）通过jsp标签方式授权</p><p><img src="img/4.png" alt=""></p><p>​        （4）授权测试</p><p><img src="img/5.png" alt=""></p><ol start="2"><li><strong>每次授权都要通过realm查询数据库，对于系统性能有很大影响，可通过shiro缓存解决</strong></li></ol><p>​       Shiro中提供了对认证信息和授权信息的缓存，shiro默认是关闭认证信息缓存的，对于授权信息的缓存shiro默认开启的。主要研究授权信息缓存，因为授权的数据量大。</p><p>  （1）<strong>Shiro缓存流程</strong></p><p>当用户认证通过</p><p>该用户第一次授权：调用realm查询数据库</p><p>该用户第二次授权：不调用realm查询数据库，直接从缓存中取出授权信息（权限标识符）</p><p>  （2） <strong>使用ehcache</strong></p><pre><code>     1. 配置cacheManager</code></pre><p><img src="img/6.png" alt=""></p><p><img src="img/7.png" alt=""></p><ol start="2"><li>配置cacheManager</li></ol><p><img src="img/8.png" alt=""></p><ol start="3"><li><p>缓存清空</p><p>如果用户正常退出，缓存自动清空</p><p>如果用户非正常退出，缓存自动清空</p><p>如果修改了用户的权限，而用户不退出系统，修改的权限无法立即生效。</p><p>需要手动进行编程实现：</p><p>​    在权限修改后调用realm的clearCache方法清空缓存。</p><p>下边的代码正常开发时要放在service中调用</p><p>在service中，权限修改后调用下面的方法。</p><p>在realm中定义clearCache方法</p></li></ol><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//清除缓存</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearCached</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    PrincipalCollection principals <span class="token operator">=</span> SecurityUtils<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span>principals<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="sessionManager"><a href="#sessionManager" class="headerlink" title="sessionManager"></a>sessionManager</h3><p>和shiro整合后，使用shiro的session管理，shiro提供sessionDao操作会话数据</p><p><strong>配置sessionManager</strong></p><p><img src="img/9.png" alt=""></p><p><img src="img/10.png" alt=""></p><h3 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h3><p><strong>思路</strong></p><p>Shiro使用FormAuthenticationFilter进行表单认证，验证校验的功能应该加在FormAuthenticationFilter中，在认证之前进行验证码校验</p><p> 需要一个FormAuthenticationFilter的子类，继承FormAuthenticationFilter，改写它的认证方法，在认证之前进行验证码校验</p><p><strong>自定义FormAuthenticationFilter</strong></p><p><img src="img/11.png" alt=""></p><p><strong>配置FormAuthenticationFilter</strong></p><p><img src="img/12.png" alt=""></p><p><img src="img/13.png" alt=""></p><p><img src="img/14.png" alt=""></p><h3 id="设置记住我功能（使用userFilter）"><a href="#设置记住我功能（使用userFilter）" class="headerlink" title="设置记住我功能（使用userFilter）"></a>设置记住我功能（使用userFilter）</h3><p><strong>如果设置记住我，则下次访问某些url时不用登陆，将记住我即可访问的地址配置让UserFilter拦截</strong></p><p><img src="img/15.png" alt=""></p><p><img src="img/16.png" alt=""></p><p><strong>用户身份实现java.io.Serializable接口（用于存入cookie）</strong></p><p><img src="img/17.png" alt=""></p><p><strong>配置rememberManager</strong></p><p><img src="img/18.png" alt=""></p><p><img src="img/19.png" alt=""></p><p><strong>添加rememberme界面</strong></p><p><img src="img/20.png" alt=""></p><p><strong>配置rememberMe的input名称</strong></p><p><img src="img/21.png" alt=""></p><p><img src="img/22.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> shiro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jenkins自动化部署项目</title>
      <link href="/2019/09/16/jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/"/>
      <url>/2019/09/16/jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="jenkins介绍"><a href="#jenkins介绍" class="headerlink" title="jenkins介绍"></a>jenkins介绍</h2><h3 id="jenkins概念"><a href="#jenkins概念" class="headerlink" title="jenkins概念"></a>jenkins概念</h3><p>Jenkins是一个开源的、可扩展的持续集成、交付、部署（软件/代码的编译、打包、部署）的基于web界面的平台。允许持续集成和持续交付项目，无论用的是什么平台，可以处理任何类型的构建或持续集成。</p><p>官网：<a href="https://jenkins.io/" target="_blank" rel="noopener">https://jenkins.io/</a> 官方文档：<a href="https://jenkins.io/doc/" target="_blank" rel="noopener">https://jenkins.io/doc/</a></p><h3 id="Jenkins特性"><a href="#Jenkins特性" class="headerlink" title="Jenkins特性"></a>Jenkins特性</h3><ol><li><p>开源的java语言开发持续集成工具，支持CI，CD；</p></li><li><p>易于安装部署配置：可通过yum安装,或下载war包以及通过docker容器等快速实现安装部署，可方便web界面配置管理；</p></li><li><p>消息通知及测试报告：集成RSS/E-mail通过RSS发布构建结果或当构建完成时通过e-mail通知，生成JUnit/TestNG测试报告；</p></li><li><p>分布式构建：支持Jenkins能够让多台计算机一起构建/测试；</p></li><li><p>文件识别:Jenkins能够跟踪哪次构建生成哪些jar，哪次构建使用哪个版本的jar等； </p></li><li><p>丰富的插件支持:支持扩展插件，你可以开发适合自己团队使用的工具，如git，svn，maven，docker等。</p></li></ol><h2 id="需要的环境"><a href="#需要的环境" class="headerlink" title="需要的环境"></a>需要的环境</h2><p> maven、tomcat、git、jdk，将项目自动部署到linux系统下,演示的服务器上已经安装好git和jdk就不多做解释。</p><p> jenkins、git可与maven、tomcat、jdk放在不同服务器上。本次演示均放在同一个服务器上。</p><p><strong>1. 安装maven</strong></p><p>   下载apache-maven-3.6.2-src.tar.gz，运行命令  <strong>tar -zxvf apache-maven-3.6.2-src.tar.gz /data/jenkins/maven</strong>,将文件解压到/data/jenkins/maven，修改conf文件夹下的settings.xml</p><pre><code>     &lt;mirror&gt;       &lt;id&gt;alimaven&lt;/id&gt;       &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;       &lt;name&gt;aliyun maven&lt;/name&gt;       &lt;url&gt;http://maven.aliyun.com/nexus/content/repositories/central/&lt;/url&gt;     &lt;/mirror&gt;</code></pre><p><strong>2. 安装tomcat</strong></p><p>  本次需要两个tomcat(分别命名为tomcat8_jenkins,tomcat8_”项目名“，此处项目名为“test”)，一个用来部署jenkins的war包，一个用来部署需要构建的项目。</p><ol><li><p>官网下载apache-tomcat-8.0.36.tar.gz，运行命令 <strong>tar -zxvf pache-tomcat-8.0.36.tar.gz /data/jenkins/tomcat/tomcat8_jenkins **,</strong>tar -zxvf pache-tomcat-8.0.36.tar.gz /data/jenkins/tomcat/tomcat8_“test”**。</p></li><li><p>分别修改两个tomcat的端口号防止端口占用，即修改tomcat中conf下server.xml文件如下</p><p><strong>tomcat8_jenkins</strong></p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--第一处改动--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Server</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8079<span class="token punctuation">"</span></span> <span class="token attr-name">shutdown</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>SHUTDOWN<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--第二处改动--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>9100<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>           <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>           <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token comment" spellcheck="true">&lt;!--第三处改动--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8009<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>AJP/1.3<span class="token punctuation">"</span></span> <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p><strong>tomcat8_test</strong></p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--第一处改动--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Server</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>9006<span class="token punctuation">"</span></span> <span class="token attr-name">shutdown</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>SHUTDOWN<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--第二处改动--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>9797<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>           <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>           <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token comment" spellcheck="true">&lt;!--第三处改动--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>9010<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>AJP/1.3<span class="token punctuation">"</span></span> <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>3.修改tomcat8_jenkins中conf文件夹下的tomcat-users.xml文件，如下</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>role</span> <span class="token attr-name">rolename</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tomcat<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>role</span> <span class="token attr-name">rolename</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>role1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>role</span> <span class="token attr-name">rolename</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>manager-gui<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>role</span> <span class="token attr-name">rolename</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>manager-script<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>role</span> <span class="token attr-name">rolename</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>manager-status<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tomcat<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tomcat<span class="token punctuation">"</span></span> <span class="token attr-name">roles</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tomcat<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>both<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tomcat<span class="token punctuation">"</span></span> <span class="token attr-name">roles</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tomcat,role1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>role1<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tomcat<span class="token punctuation">"</span></span> <span class="token attr-name">roles</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>role1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deploy<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tomcat<span class="token punctuation">"</span></span> <span class="token attr-name">roles</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>manager-gui,manager-script,manager-status<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre></li></ol><h2 id="安装jenkins"><a href="#安装jenkins" class="headerlink" title="安装jenkins"></a>安装jenkins</h2><p>下载jenkins.war并放在/data/jenkins/tomcat/tomcat8_jenkins/webapps中，在tomcat8_jenkins中bin目录中运行./startup.sh启动tomcat8_jenkins。</p><h2 id="配置jenkins"><a href="#配置jenkins" class="headerlink" title="配置jenkins"></a>配置jenkins</h2><h3 id="打开jenkins"><a href="#打开jenkins" class="headerlink" title="打开jenkins"></a>打开jenkins</h3><p>在浏览器地址中输入http://服务器ip地址:9100/jenkins/，启动界面如下：</p><p><img src="img/1.png" alt=""></p><p>根据提示将相应文件中的文本复制然后粘贴到输入框中，点击继续，安装默认的插件，需要等待一段时间，若后续需要其他的插件可通过 ManagerJenkins —&gt; ManagePlugins进行安装。</p><h3 id="安装其他插件"><a href="#安装其他插件" class="headerlink" title="安装其他插件"></a>安装其他插件</h3><p>若后续需要其他的插件可通过 ManagerJenkins —&gt; ManagePlugins进行安装。</p><p><strong>Deploy to container Plugin ， Email Extension Plugin ， Maven Integration plugin ， Publish Over SSH</strong></p><h3 id="配置GlobalToolConfiguration"><a href="#配置GlobalToolConfiguration" class="headerlink" title="配置GlobalToolConfiguration"></a>配置GlobalToolConfiguration</h3><p>点击ManagerJenkins —&gt; GlobalToolConfiguration配置如下，实际路径以自己的为准。</p><p><img src="img/10.png" alt=""></p><p><img src="img/11.png" alt=""></p><p><img src="img/12.png" alt=""></p><p><img src="img/13.png" alt=""></p><h3 id="配置ConfigureSystem"><a href="#配置ConfigureSystem" class="headerlink" title="配置ConfigureSystem"></a>配置ConfigureSystem</h3><p> 点击ManagerJenkins —&gt; ConfigureSystem 配置如下几处</p><p><img src="img/14.png" alt=""></p><p>若未设置邮件地址，则构建后邮件通知功能失效</p><p><img src="img/15.png" alt=""></p><p>此处邮箱为POP3邮箱，直接输入邮箱密码即可</p><p><img src="img/16.png" alt=""></p><p><img src="img/17.png" alt=""></p><p>DefaultContent脚本为</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>${ENV, var="JOB_NAME"}-第${BUILD_NUMBER}次构建日志<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">leftmargin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token attr-name">marginwidth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">topmargin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token attr-name">marginheight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span>    <span class="token attr-name">offset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>95%<span class="token punctuation">"</span></span> <span class="token attr-name">cellpadding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">cellspacing</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name">        <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">11</span>pt<span class="token punctuation">;</span> <span class="token property">font-family</span><span class="token punctuation">:</span> Tahoma, Arial, Helvetica, sans-serif</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font</span><span class="token punctuation">></span></span>来自Mr.Jenkins的邮件通知<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>font</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#0B610B<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>构建信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>font</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">></span></span>               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>项目名称<span class="token entity" title="&nbsp;">&amp;nbsp;</span>：<span class="token entity" title="&nbsp;">&amp;nbsp;</span>${PROJECT_NAME}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>触发原因<span class="token entity" title="&nbsp;">&amp;nbsp;</span>：${CAUSE}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>                        构建日志<span class="token entity" title="&nbsp;">&amp;nbsp;</span>：<span class="token entity" title="&nbsp;">&amp;nbsp;</span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${BUILD_URL}console<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            ${BUILD_URL}console                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>                        单元测试报告<span class="token entity" title="&nbsp;">&amp;nbsp;</span>：                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${BUILD_URL}testReport/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            ${BUILD_URL}testReport/                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>                        测试报告<span class="token entity" title="&nbsp;">&amp;nbsp;</span>：<span class="token entity" title="&nbsp;">&amp;nbsp;</span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${PROJECT_URL}ws<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            ${PROJECT_URL}ws/trunk/code/LopWeb/target/site/surefire-report.html                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>                       覆盖率报告<span class="token entity" title="&nbsp;">&amp;nbsp;</span>：<span class="token entity" title="&nbsp;">&amp;nbsp;</span>                       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${PROJECT_URL}ws/trunk/code/LopWeb/target/site/jacoco/index.html<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                           ${PROJECT_URL}ws                       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>                       工作目录<span class="token entity" title="&nbsp;">&amp;nbsp;</span>：<span class="token entity" title="&nbsp;">&amp;nbsp;</span>                       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${PROJECT_URL}ws<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                           ${PROJECT_URL}ws                       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#0B610B<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>构建日志:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>font</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>80<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>30<span class="token punctuation">"</span></span> <span class="token attr-name">readonly</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>readonly<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name">                    <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">font-family</span><span class="token punctuation">:</span> Courier New</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>${BUILD_LOG}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>覆盖率报告<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>${FILE ,path="C:/Program Files (x86)/Jenkins/workspace/                    DOM/trunk/code/LopWeb/target/site/jacoco/index.html"}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>通过SSH将Jenkins从svn拉取的代码通过maven打包war发送到远程服务器进行部署</p><p><img src="img/18.png" alt=""></p><h3 id="创建并配置项目"><a href="#创建并配置项目" class="headerlink" title="创建并配置项目"></a>创建并配置项目</h3><ol><li>接着创建一个maven项目（若没有此选项，则需在jenkins下载maven插件）</li></ol><p><img src="img/2.png" alt=""></p><ol start="2"><li>配置svn地址</li></ol><p><img src="img/3.png" alt=""></p><ol start="3"><li>构建触发器：</li></ol><p>Build periodically：周期性进行项目构建，这个是到指定的时间必须触发构建任务,此处设为每三十分钟</p><p>Poll SCM:定时检查源码变更（根据SCM软件的版本号），如果有更新就checkout最新code下来，然后执行构建动作，此处设为每十分钟检查一次</p><p><img src="img/4.png" alt=""></p><ol start="4"><li>PreSteps:</li></ol><p>构建前先执行如下命令，未设置 chmod 777 restart-tomcat8.sh 脚本会执行失败。</p><p><img src="img/5.png" alt=""></p><p>脚本内容如下：</p><pre class=" language-shell"><code class="language-shell">#/bin/bash#这一句必须得有，不然会执行失败，路径根据实际情况配置export JAVA_HOME=/data/jdk1.8.0_161#先删除tomcat下之前打的war包及其解压包rm -rf /data/jenkins/tomcat/tomcat8/webapps/LopWeb*echo -e "\n\n\n"#force kill flag,if equal [f] to force kill allflag="HelloShell"if test $# -gt 0then    flag=$1fipids=`ps -ef|grep tomcat8 | grep -v "grep" | awk '{print $2}'`#pids=`ps -ef|grep -w tomcat | grep -v "grep" | awk '{print $2}'`count=0pid_num=0for pid in ${pids}do    pid_num=${pid}    count=`expr ${count} + 1`doneif test $[count] -gt 1then    if test $flag = "f"    then        for pid in ${pids}        do            echo "kill " ${pid}            kill -9 ${pid}        done        echo "Force kill more progress success!"    else        echo "Exist more progress is running, Input param [f] to force kill."    fielse    if test $[count] -eq 1    then        kill -9 ${pid_num}        echo "Kill " ${pid_num} " Success!"    else        echo "Clear!"    fifi# startecho "start tomcat8"bash /data/jenkins/tomcat/tomcat8/bin/startup.shecho -e "\n\n\n"</code></pre><ol start="5"><li><p>Build</p><p><strong>RootPOM</strong>：项目中pom.xml地址。</p><p><strong>Goals and options:</strong>目的是maven 打包执行的命令。mvn surefire-report:report 作用是生成代码测试报告。若需要生成测试报告则需要在项目pom.xml文件中加入如下配置：</p><pre class=" language-xml"><code class="language-xml">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-surefire-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.0.0-M3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testFailureIgnore</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testFailureIgnore</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 限定跑哪些测试类 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>          <span class="token comment" spellcheck="true">&lt;!-- "**/Test*.java" - includes all of its subdirectories and all Java filenames that start with "Test". --></span>          <span class="token comment" spellcheck="true">&lt;!-- "**/*Test.java" - includes all of its subdirectories and all Java filenames that end with "Test". --></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*Test.java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>          <span class="token comment" spellcheck="true">&lt;!-- 支持正则 http://maven.apache.org/surefire/maven-surefire-plugin/examples/inclusion-exclusion.html--></span>          <span class="token comment" spellcheck="true">&lt;!-- &lt;include>%regex[.*(Cat|Dog).*Test.*]&lt;/include> --></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span></code></pre><p><img src="img/6.png" alt=""></p></li><li><p>构建后操作</p><p> 设置项目打包后发布的容器地址</p><p><img src="img/7.png" alt=""></p><p>设置构建后邮箱通知，点击下方圈红按钮设置触发条件</p></li></ol><p><img src="img/8.png" alt=""></p><p><img src="img/9.png" alt=""></p><h3 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h3><p>点击BuildNow，第一次运行maven需要下载jar文件，所以会比较慢。</p><p><img src="img/19.png" alt=""></p><p><img src="img/20.png" alt=""></p><p>邮件内容如下</p><p><img src="img/21.png" alt=""></p><h3 id="构建失败的一些问题"><a href="#构建失败的一些问题" class="headerlink" title="构建失败的一些问题"></a>构建失败的一些问题</h3><pre class=" language-java"><code class="language-java">Caused by<span class="token operator">:</span> org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>cargo<span class="token punctuation">.</span>container<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>TomcatManagerException<span class="token operator">:</span>The Tomcat Manager responded "FAIL <span class="token operator">-</span> Deployed application at context path <span class="token punctuation">[</span><span class="token operator">/</span>LopWeb<span class="token punctuation">]</span>but context failed to start<span class="token string">" instead of the expected "</span>OK" message    此问题在构建成功，发布到容器时报的错误，一般是项目的问题，此实验为项目数据库未连接成功导致的，具体情况可根据数据库日志查看</code></pre><pre class=" language-java"><code class="language-java"><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> Failed to execute goal on project LopWeb<span class="token operator">:</span>Could not resolve dependencies <span class="token keyword">for</span> project com<span class="token punctuation">.</span>asiainfo<span class="token punctuation">.</span>lop<span class="token operator">:</span>LopWeb<span class="token operator">:</span>war<span class="token operator">:</span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">:</span>The following artifacts could not be resolved<span class="token operator">:</span> com<span class="token punctuation">.</span>ibm<span class="token punctuation">.</span>db2<span class="token operator">:</span>db2jcc<span class="token operator">:</span>jar<span class="token operator">:</span><span class="token number">9.7</span><span class="token punctuation">,</span> com<span class="token punctuation">.</span>ibm<span class="token punctuation">.</span>db2<span class="token operator">:</span>db2java<span class="token operator">:</span>jar<span class="token operator">:</span><span class="token number">9.7</span><span class="token operator">:</span>Failure to find com<span class="token punctuation">.</span>ibm<span class="token punctuation">.</span>db2<span class="token operator">:</span>db2jcc<span class="token operator">:</span>jar<span class="token operator">:</span><span class="token number">9.7</span> inhttp<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">1.8</span><span class="token operator">:</span><span class="token number">8081</span><span class="token operator">/</span>repository<span class="token operator">/</span>maven<span class="token operator">-</span><span class="token keyword">public</span> was cached in the local repository<span class="token punctuation">,</span>resolution will not be reattempted until the update interval of asiaInfomaven haselapsed or updates are forced <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span>Help <span class="token number">1</span><span class="token punctuation">]</span>缺少相应的jar包</code></pre><pre class=" language-java"><code class="language-java">ERROR<span class="token operator">:</span> Error fetching remote repo <span class="token string">'origin'</span>hudson<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>git<span class="token punctuation">.</span>GitException<span class="token operator">:</span>Failed to fetch from ssh<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>git<span class="token annotation punctuation">@10</span><span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">.</span><span class="token number">106</span><span class="token operator">:</span><span class="token number">22022</span><span class="token operator">/</span>DOM<span class="token operator">/</span>LopWeb<span class="token punctuation">.</span>git连接公司项目git可能需要内网，开启vpn即可</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> jenkins </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
